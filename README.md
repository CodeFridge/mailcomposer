# mailcomposer

This is going to be a module for generating e-mail messages that can be
streamed to SMTP etc.

[![Build Status](https://secure.travis-ci.org/andris9/mailcomposer.png)](http://travis-ci.org/andris9/mailcomposer)

See autogenerated docs [here](http://www.node.ee/mcdoc/).

## Installation

Install through NPM

    npm install mailcomposer

## Usage

### Include mailcomposer module

    var MailComposer = require("mailcomposer").MailComposer;

### Create a new `MailComposer` instance

    var mailcomposer = new MailComposer([options]);

Where `options` is an optional options object with the following possible properties:

  * **escapeSMTP** - if set replaces dots in the beginning of a line with double dots
  * **encoding** - sets transfer encoding for the textual parts (defaults to `"quoted-printable"`)

### Add message parts

### Add attachments

### Start streaming

When the message data is setup, streaming can be started

    mailcomposer.streamMessage();

This generates `'data'` events for the message headers and body and final `'end'` event.
As `MailComposer` objects are Stream instances, these can be piped

    // save the output to a file
    mailcomposer.streamMessage();
    mailcomposer.pipe(fs.createWriteStream("out.txt"));

## Envelope

Envelope is emitted with an `'envelope'` event and it has an object as a param
that includes a `from` address (string) and a list of `to` addresses (array of
strings) suitable for forwarding to a SMTP server as `MAIL FROM:` and `RCPT TO:`.

    mailcomposer.on("envelope", function(envelope){
        console.log(envelope);
        // {from:"sender@example.com", to:["receiver@example.com"]}
    });


## Running tests

Tests are run with [nodeunit](https://github.com/caolan/nodeunit)

Run

    npm test

or alternatively

    node run_tests.js

## License

**MIT**